# 修改总内存大小和保留内存大小
## UBoot下设置内存
在uboot中可以修改系统能使用的总内存大小和保留内存大小，便于测试不同的物理内存大小的影响。

进入uboot命令行，比如开发实际内存大小为1G，可改为512M

```bash
setenv mem_size 0x20000000
```
修改保留内存大小为128M,  此区域为 IPU, BPU, ISP硬件使用的连续物理内存区域
```bash
setenv ion_size '128'
boot
```
## 设置BPU保留内存
当ion选择cma作为内存池时，通过cma区域来为BPU mem划分空间，以此兼顾cma的灵活性和预留空间的效率，该空间大小可在系统启动后通过修改/sys节点修改：
```bash
echo 100 > /sys/class/misc/ion/cma_carveout_size
```
通过上述方式修改该空间大小单位为Mbyte，需根据实际场景需求做不同配置(如多路场景下若vio报ion_alloc错误，则可适当降低该空间大小，最小可到0)，设置0值表示BPU只使用cma来动态分配(若无sys该节点表示该版本暂不支持此方式配置)。

注意：只有当没有用户使用BPU_MEM时才可以修改成功，由于该空间为从cma中申请的连续物理地址空间，可申请到的最大大小无法达到cma总大小。当BPU_MEM无法从该空间中申请到足够的内存时，系统会尝试从该空间之外的cma空间申请。

因为这部分预留是从cma中分配出的连续物理空间，所以设置有可能失败，设置了之后再cat一下这个节点，成功的话就是设置的值，失败就是0。
