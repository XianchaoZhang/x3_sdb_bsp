<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7.1. 地平线产品升级工具使用手册 &mdash; X3 用户手册 1.0.1 文档</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/horizon_theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/horizon.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/hobot.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="8. FAQ" href="../FAQs/index.html" />
    <link rel="prev" title="7. PC工具使用指南" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> X3 用户手册
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../preface/index.html">1. 前言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start/index.html">2. 快速入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../samples/index.html">3. Demo使用指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bsp_develop/index.html">4. BSP开发指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mpp_develop/index.html">5. 多媒体开发指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ai_toolchain_develop/index.html">6. 量化工具链开发指南</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">7. PC工具使用指南</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">7.1. 地平线产品升级工具使用手册</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">7.1.1. 升级工具基本介绍</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">7.1.1.1. 基本操作介绍</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">7.1.1.2. 菜单介绍</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">7.1.1.3. 升级配置介绍</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">7.1.1.4. 产品配置介绍</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id7">7.1.2. 下载模式介绍</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">7.1.2.1. 初次使用时注意事项</a></li>
<li class="toctree-l4"><a class="reference internal" href="#uart-uboot">7.1.2.2. uart／uboot下载模式</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fastboot">7.1.2.3. fastboot下载模式</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id9">7.1.3. 配置文件介绍</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">7.1.3.1. 升级工具基本设置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">7.1.3.2. 产品类型设置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">7.1.3.3. 产品设置文件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boot">7.1.3.4. 自定义boot文件</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../FAQs/index.html">8. FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feedback.html">9. 建议反馈</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">X3 用户手册</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">7. </span>PC工具使用指南</a> &raquo;</li>
      <li><span class="section-number">7.1. </span>地平线产品升级工具使用手册</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="index.html" class="btn btn-neutral float-left" title="7. PC工具使用指南" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../FAQs/index.html" class="btn btn-neutral float-right" title="8. FAQ" accesskey="n">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1><span class="section-number">7.1. </span>地平线产品升级工具使用手册<a class="headerlink" href="#id1" title="永久链接至标题"></a></h1>
<section id="id2">
<h2><span class="section-number">7.1.1. </span>升级工具基本介绍<a class="headerlink" href="#id2" title="永久链接至标题"></a></h2>
<section id="id3">
<h3><span class="section-number">7.1.1.1. </span>基本操作介绍<a class="headerlink" href="#id3" title="永久链接至标题"></a></h3>
<p>升级工具支持windows64位系统和ubuntu14.04及以上版本</p>
<p>用户以压缩包的形式下载到工程文件，需要在对应平台内解压，解压后，按照如下说明运行程序：</p>
<ol class="simple">
<li><p>windows平台：双击hbupdate.exe文件打开</p></li>
<li><p>linux平台：需要在终端中sudo ./hbupdate-linux/hbupdate-linux运行软件
运行软件后，在主界面中填写/选择相应参数后，点击“开始升级”按钮后，自动开始升级
参数选择将在本章之后的内容说明，不同下载方式及对应参数选择将在第二章说明
主界面示意图如下：</p></li>
</ol>
<p><img alt="../_images/image-20220327113534995.png" src="../_images/image-20220327113534995.png" /></p>
</section>
<section id="id4">
<h3><span class="section-number">7.1.1.2. </span>菜单介绍<a class="headerlink" href="#id4" title="永久链接至标题"></a></h3>
<p>菜单部分如下图所示：</p>
<p>文件示意图</p>
<p><img alt="../_images/image-20220327113546288.png" src="../_images/image-20220327113546288.png" /></p>
<p>产品类型示意图</p>
<p><img alt="../_images/image-20220327113554301.png" src="../_images/image-20220327113554301.png" /></p>
<p>擦除示意图</p>
<p><img alt="../_images/image-20220327113602096.png" src="../_images/image-20220327113602096.png" /></p>
<p>波特率示意图</p>
<p><img alt="../_images/image-20220327113608839.png" src="../_images/image-20220327113608839.png" /></p>
<p>升级模板示意图</p>
<p><img alt="../_images/image-20220327113618051.png" src="../_images/image-20220327113618051.png" /></p>
<p>菜单包括：文件，产品类型，波特率，升级模板 <strong>文件包括：</strong></p>
<ol class="simple">
<li><p>语言切换——可以切换”中文”，”English”，在一种语言下，菜单显示另一种语言文字</p></li>
<li><p>保存设置——对当前界面进行保存，下次打开软件后，所有设置与保存前相同</p></li>
<li><p>退出——关闭软件</p></li>
</ol>
<p><strong>产品类型包括：</strong>”XJ3-key1”等系列产品，勾选后，升级配置中可选择相应的子产品类型。</p>
<p><strong>擦除包括：</strong>“all/veeprom/miniboot/uboot/vbmeta/boot”等分区，在升级前，可以选择这些分区来进行升级前的擦除操作，all表示擦除整个芯片。</p>
<p><strong>波特率包括：</strong>“4800/9600/38400/115200/921600”以供选择，默认为921600波特率。这里如果工具设置的波特率和板子实际的波特率不一致，uart/uboot升级会导致工具无法连接上板子，所以在升级前最好确认好板子的波特率。</p>
<p><strong>升级模板包括：</strong>“x3sdb”、“x3sdb-Ubuntu”等，这里如果知道自己的som类型的话，可以通过选择这里一键配置（主要ddr内容类型）。</p>
</section>
<section id="id5">
<h3><span class="section-number">7.1.1.3. </span>升级配置介绍<a class="headerlink" href="#id5" title="永久链接至标题"></a></h3>
<p>升级配置示意图</p>
<p><img alt="../_images/image-20220327113953703.png" src="../_images/image-20220327113953703.png" /></p>
<p>升级配置包括：产品名称，下载模式，下载方式，内存类型，升级后检查选择，显示串口输出选择，不同升级文件，升级文件分段，整个分区擦除，boot文件选择，升级文件选择和开始升级按钮</p>
<p><strong>产品名称：</strong> 可以选择产品类型下支持的产品</p>
<p><strong>下载模式：</strong></p>
<p>不同产品支持的下载模式可能不同，可支持：”uboot”、”uart”、“fastboot”。</p>
<p><strong>下载方式：</strong></p>
<p>不同产品名称和不同的下载模式支持的下载方式也可能不同，总共可支持“uart”, “tftp”,  “fastboot”。</p>
<p>在选择”uart”或”uboot”下载模式后，用于选择文件传输方式，可选择“uart”、“tftp”、“fastboot”三种下载方式。这里下载方式和下载模式选择的区别：下载模式可以理解为从哪个状态开始升级，如果板子成砖的话，必须选择uart下载模式，如果板子可以启动进入到uboot，则可以选择uboot下载模式，如果板子可以启动进入到kernel下，则可以选择fastboot下载模式；而下载方式的话可以理解为传输方式，升级可以通过uart、tftp和fastboot方式下载到开发板上。</p>
<p><strong>内存类型：</strong></p>
<p>在选择”uart”下载模式后，用于选择产品ddr类型或者串口启动的boot相关的配置文件，具体文件内容详见 <a class="reference external" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D">配置文件介绍</a>。</p>
<p><strong>不同升级文件：</strong></p>
<p>可以选择不同分区的升级文件来一并升级。</p>
<p><strong>升级文件分段：</strong></p>
<p>如果镜像实际大小，大于了内存大小，需要提前将镜像分段（software_tools/update_tools/separate_disk.sh 脚本可以帮助拆分镜像），选择这个选项，然后把分段的镜像一一在文件浏览中选择上，便可成功升级。注：只适合于“uart/uboot”+tftp的升级方式。</p>
<p><strong>整个分区擦除：</strong></p>
<p>如果在菜单栏 <strong>擦除</strong> 中有勾选擦除的分区，默认只擦除该分区的superblock分区（目的是为了提高擦除速度和延长flash使用寿命），如果想要整个分区全部擦除，请勾选这个选项。</p>
<p><strong>升级后检查：</strong></p>
<p>此选项只针对“<em>下载模式</em>”为“uboot”和“uart”。如果勾选此项，将会在升级结束后，自动重启板子，以能否进入X3端Linux shell作为升级是否成功的判断依据。不勾选则升级完成后不对板子做任何操作，由用户自行重启检查。</p>
<p><strong>显示串口输出：</strong></p>
<p>勾选后，板子的串口输出内容会显示在“<em>升级信息中</em>“，方便debug。</p>
<p><strong>boot文件选择：</strong></p>
<p>如果下载模式选择“uart”，内存选择“choose”，这个浏览按钮便会使能，说明要使用自己的boot文件，在这里选上自己的boot文件（json文件)，可以参考 <a class="reference external" href="#%E8%87%AA%E5%AE%9A%E4%B9%89boot%E6%96%87%E4%BB%B6">自定义boot文件</a>。</p>
<p><strong>升级文件：</strong></p>
<p>点击“<em>浏览…</em>”按钮，选择待升级的文件，不同的“<em>下载模式</em>”下，支持的升级文件详见 <a class="reference external" href="#%E4%B8%8B%E8%BD%BD%E6%A8%A1%E5%BC%8F%E4%BB%8B%E7%BB%8D">下载模式介绍</a></p>
<p><strong>开始升级：</strong></p>
<p>各种选项都填好后，就可以点击“<em>开始升级</em>”来进行升级。</p>
<p>升级的时间取决于镜像的大小、“*下载模式”*以及“<em>下载方式”</em>，升级成功或者失败会弹出确认框。</p>
<p>如果升级失败，请仔细观察“<em>升级信息</em>”中的输出，确认升级失败原因。</p>
</section>
<section id="id6">
<h3><span class="section-number">7.1.1.4. </span>产品配置介绍<a class="headerlink" href="#id6" title="永久链接至标题"></a></h3>
<p>板端配置示意图</p>
<p><img alt="../_images/image-20220327114350862.png" src="../_images/image-20220327114350862.png" /></p>
<p>产品配置包括：“板端配置”，“PC配置”。 （板端：指X3开发板，也指CP端）</p>
<p><strong>板端配置包含：</strong></p>
<ul class="simple">
<li><p><strong>CP IP地址（板端IP地址)：</strong></p></li>
</ul>
<p>如果需要升级的产品CP端有网口，那么此处填写的是CP端的IP地址，用于CP端从PC下载镜像。</p>
<ul class="simple">
<li><p><strong>MAC地址：</strong></p></li>
</ul>
<p>如果选择”uart”或”uboot”下载模式时，此处填写uboot命令行下设置的MAC地址，格式为：*:*: *: *: *: *，如00:05:01:02:03:04 注意：不要手动配置PC
IP地址为“169.254.”网段。</p>
<ul class="simple">
<li><p><strong>子网掩码：</strong></p></li>
</ul>
<p>如果选择的产品类型CP端有网口，且在uboot/uart下载模式中，那么此处填写的是CP端的子网掩码。</p>
<ul class="simple">
<li><p><strong>网关地址：</strong></p></li>
</ul>
<p>如果选择的产品类型CP端有网口，且在uboot/uart下载模式中，那么此处填写的是CP端的网关地址，对于板子和电脑直连的情况，网关地址填写为电脑与板子连接网卡的IP地址。</p>
<p><strong>PC配置包括：</strong></p>
<ul class="simple">
<li><p><strong>串口：</strong></p></li>
</ul>
<p>选择CP端连接电脑后识别到的串口号，后面的“刷新”按钮用于插拔串口线后刷新串口列表。如果选择tftp模式，将通过网口对于CP端操作。如果下载模式为“fastboot”，串口强制为“N/A”，将通过usb线对CP端进行操作。</p>
<ul class="simple">
<li><p><strong>IP地址 /fastboot设备：</strong></p></li>
</ul>
<p>如果选择fastboot模式，选择相应的fastboot设备，其他模式则配置PC端与产品联通的电脑网卡的IP地址。后面的“刷新”按钮用于刷新PC的IP地址列表。</p>
</section>
</section>
<section id="id7">
<h2><span class="section-number">7.1.2. </span>下载模式介绍<a class="headerlink" href="#id7" title="永久链接至标题"></a></h2>
<p>升级工具支持windows64位系统和ubuntu14.04及以上版本</p>
<p>下载模式支持类型包括：”uboot”、”uart”、“fastboot”</p>
<section id="id8">
<h3><span class="section-number">7.1.2.1. </span>初次使用时注意事项<a class="headerlink" href="#id8" title="永久链接至标题"></a></h3>
<p><strong>注意事项：</strong></p>
<ol class="simple">
<li><p>升级工具的解压路径请不要包含中文字符、空格和特殊字符</p></li>
<li><p>串口不能重复打开，点击”开始下载”之后会提示（串口被占用）错误</p></li>
<li><p>升级工具要求强制开启tftp服务，若工具不能申请到69号端口，系统软件将报错后关闭，此时需要检查（1）系统本身是否有其他应用打开tftp服务，或系统是否自带tftp服务，（2）是否多次打开升级工具。</p></li>
<li><p>多数下载情况需要网络，请确定设备ip和pc
ip保持在同一网段，网段内不能有重复ip。</p></li>
</ol>
<p><strong>使用建议：</strong></p>
<ol class="simple">
<li><p>系统可以完全启动的情况下，建议使用fastboot模式，速度最快，其次使用uboot模式</p></li>
<li><p>在系统起不来的情况下再使用uart模式，注意确定ddr种类</p></li>
<li><p>板子开启secure boot功能后，系统各分区之间镜像会有校验，不建议单独升级单个分区，建议升级完整镜像</p></li>
<li><p>在需要网络下载的情况下，尽量选择网线直连</p></li>
<li><p>在可以勾选”显示串口输出”的情况下，尽量勾选，若升级失败，方便排查问题</p></li>
</ol>
</section>
<section id="uart-uboot">
<h3><span class="section-number">7.1.2.2. </span>uart／uboot下载模式<a class="headerlink" href="#uart-uboot" title="永久链接至标题"></a></h3>
<p><strong>简要说明：</strong></p>
<p>uart下载方式是PC机先通过串口发送uart下载指令，使芯片进入uart下载模式，通过Xmodem协议及Ymodem协议将spl，ddr，uboot二进制文件写入内存内运行进入uboot，在uboot模式下将需要的镜像写入eMMC中。</p>
<p>uboot下载方式是在系统有完整uboot的条件下，进入uboot后通过tftp将需要的镜像下载在ddr中，再通过mmc write把镜像写入eMMC中。</p>
<p>进入uboot后可以下载系统完整镜像，也可以单独下载uboot、kernel、system分区镜像，由于uart下载模式通常在系统不可恢复的情况下使用，因此在uart下载模式下，下载镜像必须是系统完整镜像。</p>
<p><strong>连接方式：</strong></p>
<p>uart/uboot升级有多种连接方式：</p>
<ul class="simple">
<li><p>串口+网线：串口向板端发送命令，通过tftp向板端传输升级包</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>下载模式：uart 或者 uboot
下载方式：tftp
板端配置：CP IP、网关地址、子网掩码
PC配置：选择对应串口号、PC IP
</pre></div>
</div>
<ul class="simple">
<li><p>单一串口线：可以通过串口发送命令，通过ymodem串口协议传输升级包</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>下载模式：uart
下载方式：uart
板端配置：无
PC配置：选择对应串口号
</pre></div>
</div>
<ul class="simple">
<li><p>串口+usb线：可以通过串口发送命令，通过fastboot传输升级包</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>下载模式：uart 或 uboot
下载方式：fastboot
板端配置：无
PC配置：选择对应串口号
</pre></div>
</div>
<p><strong>设备要求：</strong></p>
<ul class="simple">
<li><p>对于”uart”下载模式，需要芯片内bootrom代码运行正常，可以通过给设备上电后查看串口是否输出”NOTICE: Booting Trusted Firmware”等信息。</p></li>
<li><p>对于”uboot”模式，需要芯片内系统可以正常启动到uboot命令行模式下</p></li>
</ul>
<p><strong>支持升级的文件类型：</strong></p>
<ul>
<li><p>“uart/uboot”方式下都支持完整镜像和各分区镜像：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 完整镜像命名格式</span>
*.img
*disk*.img
<span class="c1"># 各分区镜像命名格式</span>
sbl*.img
ddr*.img
bl31*.img
uboot.img
kernel.img
boot.img
system.img
app*.img
ut*.img
gpt_backup*.img
u-boot-spl*.bin
*mcore*.img.bin
*ddrc*.img.bin
*bl31*.img.bin
*uboot*.img.bin
vbmeta*.img
bpu*.bin
userdata*.img
*.img
</pre></div>
</div>
<p>具体支持哪些镜像格式可参考升级工具目录下的 data/config.json， 也支持自定义修改。</p>
<p>注意这里是根据镜像名称来判断要升级的分区，如果无法识别或者以*disk*.img都是默认按整个分区烧录的方式。</p>
</li>
<li><p><strong>注意事项：</strong></p></li>
</ul>
<ol class="simple">
<li><p>设置界面-&gt;板端配置-&gt;CP IP地址，需要保证CP IP地址与PC IP地址能够ping通。</p></li>
<li><p>推荐直连网线的模式，因为tftp传输协议较tcp协议不稳定，需要连接路由等复杂环境下稳定性较差。</p></li>
<li><p>efuse烧写的产品，镜像各分区校验关系很强，升级工具保留分区下载功能，但不建议单独分区下载，建议下载完整镜像。</p></li>
</ol>
</section>
<section id="fastboot">
<h3><span class="section-number">7.1.2.3. </span>fastboot下载模式<a class="headerlink" href="#fastboot" title="永久链接至标题"></a></h3>
<p><strong>简要说明：</strong></p>
<p>fastboot是与Android设备的bootloader进行交互所使用的协议。uboot下fastboot命令将X3芯片伪装了一个usb从设备，连接后PC就会识别到一个android设备，PC可以通过fastboot软件与芯片进行通信。</p>
<p><strong>连接方式：</strong></p>
<p>只需要usb线连接板端和PC端</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>下载模式：fastboot
下载方式：无
板端配置：无
PC配置：刷新后选择对应的usb设备
</pre></div>
</div>
<p><strong>设备要求：</strong></p>
<p>系统uboot支持fastboot模式，系统能正常启动并且电脑显示有adb设备或者系统已经进入fastboot模式。</p>
<p>手动进入fastboot模式的两种方法：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># 1. 在uboot命令行模式下执行
HOBOT&gt; fastboot 0
# 2. 在shell命令行模式下执行
$ reboot fastboot
</pre></div>
</div>
<p><strong>支持升级的文件类型：</strong></p>
<p>fastboot升级根据选择的文件不同分为两种：</p>
<p>1、选择完整镜像升级直接选择disk*.img文件进行升级</p>
<p>2、选择配置文件升级：该模式下解析选择的json文件，升级相应的分区包括：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mbr*.bin
gpt_main*.img
bl31*.img
sbl*.img
uboot.img
vbmate*.img
boot.img 
recovery*.img
system.img
</pre></div>
</div>
<p>fastboot配置文件需要与所需镜像放置同一目录，如果镜像放置在与配置文件相对路径fastboot文件下，则配置文件格式如下所示</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;mbr&quot;</span><span class="p">:</span> <span class="s2">&quot;fastboot/mbr.bin&quot;</span><span class="p">,</span>
    <span class="nt">&quot;gpt&quot;</span><span class="p">:</span> <span class="s2">&quot;fastboot/gpt_main.img&quot;</span><span class="p">,</span>
    <span class="nt">&quot;sbl&quot;</span><span class="p">:</span> <span class="s2">&quot;fastboot/sbl.img&quot;</span><span class="p">,</span>
    <span class="nt">&quot;bl31&quot;</span><span class="p">:</span> <span class="s2">&quot;fastboot/bl31.img&quot;</span><span class="p">,</span>
    <span class="nt">&quot;vbmeta&quot;</span><span class="p">:</span> <span class="s2">&quot;fastboot/vbmeta.img&quot;</span><span class="p">,</span>
    <span class="nt">&quot;uboot&quot;</span><span class="p">:</span> <span class="s2">&quot;fastboot/uboot.img&quot;</span><span class="p">,</span>
    <span class="nt">&quot;boot&quot;</span><span class="p">:</span> <span class="s2">&quot;fastboot/boot.img&quot;</span><span class="p">,</span>
    <span class="nt">&quot;recovery&quot;</span><span class="p">:</span> <span class="s2">&quot;fastboot/recovery.img&quot;</span><span class="p">,</span>
    <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;fastboot/system.img&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id9">
<h2><span class="section-number">7.1.3. </span>配置文件介绍<a class="headerlink" href="#id9" title="永久链接至标题"></a></h2>
<p>在升级工具中配有JSON文件，里边包含所有可升级产品的升级信息。JSON文件随升级工具一同发布前，正常使用时不建议客户自行修改。</p>
<p>以x3_sdb产品配置文件为例，配置文件关系如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>data/config.json(“products”) 
	-&gt; data/board_config/xj3-key1/xj3_sdb.json(“boot_config”)
		-&gt; data/board_config/xj3-key1/boot_config/xj3_sdb_lpddr4_samsung_secure_boot.json
</pre></div>
</div>
<p>本章对一些关键配置进行举例说明，内容可能与实际拿到的升级工具中内容有出入。</p>
<section id="id10">
<h3><span class="section-number">7.1.3.1. </span>升级工具基本设置<a class="headerlink" href="#id10" title="永久链接至标题"></a></h3>
<p>在data/config.json文件中设置升级工具的基本设置</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;compress_img&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;check_latest&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;external_tftp&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;total_baudrate&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;4800&quot;</span><span class="p">,</span> <span class="s2">&quot;9600&quot;</span><span class="p">,</span> <span class="s2">&quot;38400&quot;</span><span class="p">,</span> <span class="s2">&quot;115200&quot;</span><span class="p">,</span> <span class="s2">&quot;921600&quot;</span><span class="p">],</span>
    <span class="nt">&quot;ota_support_files&quot;</span><span class="p">:</span> <span class="s2">&quot;update files(all*.zip gpt_main*.zip sbl*.zip ddr*.zip uboot.zip boot.zip kernel.zip system.zip app*.zip bpu*.zip)&quot;</span><span class="p">,</span>
    <span class="nt">&quot;uboot_support_files&quot;</span><span class="p">:</span> <span class="s2">&quot;update files(*disk*.img gpt_main*.img sbl*.img ddr*.img uboot.img kernel.img boot.img system.img app*.img ut*.img gpt_backup*.img u-boot-spl*.bin *mcore*.img.bin *ddrc*.img.bin *bl31*.img.bin *uboot*.img.bin vbmeta*.img bpu*.bin userdata*.img *.img)&quot;</span><span class="p">,</span>
    <span class="nt">&quot;fastboot_support_files&quot;</span><span class="p">:</span> <span class="s2">&quot;update files(*disk*.img *.json)&quot;</span><span class="p">,</span>
    <span class="nt">&quot;uart_support_files&quot;</span><span class="p">:</span> <span class="s2">&quot;update files(*disk*.img gpt_main*.img u-boot-spl*.bin *mcore*.img.bin *ddrc*.img.bin *bl31*.img.bin *uboot*.img.bin *boot*.img vbmeta*.img system*.img app*.img bpu*.bin *.img)&quot;</span><span class="p">,</span>
    <span class="nt">&quot;mcu_support_files&quot;</span><span class="p">:</span> <span class="s2">&quot;update files(*.zip)&quot;</span><span class="p">,</span>
    <span class="nt">&quot;upgrade_template_list&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;template_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Ubuntu-x3sdb&quot;</span><span class="p">,</span>
            <span class="nt">&quot;product_name&quot;</span><span class="p">:</span> <span class="s2">&quot;XJ3-key1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;board_name&quot;</span><span class="p">:</span> <span class="s2">&quot;xj3_sdb&quot;</span><span class="p">,</span>
            <span class="nt">&quot;mode_select&quot;</span><span class="p">:</span> <span class="s2">&quot;uart&quot;</span><span class="p">,</span>
            <span class="nt">&quot;download_select&quot;</span><span class="p">:</span> <span class="s2">&quot;fastboot&quot;</span><span class="p">,</span>
            <span class="nt">&quot;misc_select&quot;</span><span class="p">:</span> <span class="s2">&quot;samsung-lpddr4-3200-110&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;template_name&quot;</span><span class="p">:</span> <span class="s2">&quot;X3SDB&quot;</span><span class="p">,</span>
            <span class="nt">&quot;product_name&quot;</span><span class="p">:</span> <span class="s2">&quot;XJ3-key1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;board_name&quot;</span><span class="p">:</span> <span class="s2">&quot;xj3_sdb&quot;</span><span class="p">,</span>
            <span class="nt">&quot;mode_select&quot;</span><span class="p">:</span> <span class="s2">&quot;uart&quot;</span><span class="p">,</span>
            <span class="nt">&quot;download_select&quot;</span><span class="p">:</span> <span class="s2">&quot;tftp&quot;</span><span class="p">,</span>
            <span class="nt">&quot;misc_select&quot;</span><span class="p">:</span> <span class="s2">&quot;samsung-lpddr4-3200-110&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>compress_img:
为了加快传输速度、成功率，升级软件具有对系统镜像进行压缩后传输的功能，”compress_img”为”true”是开启压缩功能，为”false”时关闭压缩功能</p></li>
<li><p>check_latest：检查升级工具最新版本</p></li>
<li><p>external_tftp: 升级工具内置有tftp server，如需要使用外部独立tftp
server，需要配置本选项开启该功能，将json等配置文件传入外部tftp
server进行升级，配置向为空则为不开启，需要使用时请填入外部tftp server的ip
地址。注意：在打开工具后，有时会提示“TFTP服务启动失败”，此时有两种情况（1）同时打开两个升级工具，（2）本地有其他应用或配置占用了tftp服务标准端口，若想保留本地tftp服务，请配置”external_tftp”字段</p></li>
<li><p>total_baudrate： 在升级工具上可以配置的波特率表</p></li>
<li><p>ota_support_files：ota下载模式下支持的镜像名和格式</p></li>
<li><p>uboot_support_files：uboot下载模式下支持的镜像名和格式</p></li>
<li><p>fastboot_support_files：fastboot下载模式下支持的镜像名和格式</p></li>
<li><p>uart_support_files：uart下载模式下支持的镜像名和格式</p></li>
<li><p>upgrade_template_list：升级工具的升级模板菜单项的配置</p></li>
</ul>
</section>
<section id="id11">
<h3><span class="section-number">7.1.3.2. </span>产品类型设置<a class="headerlink" href="#id11" title="永久链接至标题"></a></h3>
<p>data/config.json文件中的products信息：</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;products&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;XJ3-key1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;board_user&quot;</span><span class="p">:</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
            <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
            <span class="nt">&quot;uboot_prompt&quot;</span><span class="p">:</span> <span class="s2">&quot;Hobot&gt;&quot;</span><span class="p">,</span>
            <span class="nt">&quot;login_prompt&quot;</span><span class="p">:</span> <span class="s2">&quot;Horizon Robotic&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ubuntu_prompt&quot;</span><span class="p">:</span> <span class="s2">&quot;xj3ubuntu&quot;</span><span class="p">,</span>
            <span class="nt">&quot;shell_prompt&quot;</span><span class="p">:</span> <span class="s2">&quot;root@&quot;</span><span class="p">,</span>
            <span class="nt">&quot;recovery_prompt&quot;</span><span class="p">:</span> <span class="s2">&quot;/userdata/cache&quot;</span><span class="p">,</span>
            <span class="nt">&quot;boot_timeout&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
            <span class="nt">&quot;ota_update_timeout&quot;</span><span class="p">:</span> <span class="mi">380</span><span class="p">,</span>
            <span class="nt">&quot;ota_app_update_timeout&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
            <span class="nt">&quot;boards_config&quot;</span><span class="p">:</span> <span class="s2">&quot;data/board_config/xj3-key1&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>name：产品名</p></li>
<li><p>board_user：X3板端登录shell的用户名</p></li>
<li><p>password：X3板端登录shell的密码</p></li>
<li><p>uboot_prompt：X3板端uboot命令行的命令提示符</p></li>
<li><p>login_prompt：X3
板端正确启动时从串口上检测的登录提示符，uart和uboot下载模式下升级就是检测这个提示符来判断是否升级生成</p></li>
<li><p>shell_prompt：shell提示符，用来对系统当前状态做判断</p></li>
<li><p>recovery_prompt：TBD</p></li>
<li><p>boot_timeout：检测升级成功的超时时间</p></li>
<li><p>ota_update_timeout：OTA全镜像升级时检测升级成功的超时时间</p></li>
<li><p>ota_app_update_timeout： OTA升级app分区时检测升级成功的超时时间</p></li>
<li><p>boards_config：为各开发板的配置文件所在文件夹</p></li>
</ul>
</section>
<section id="id12">
<h3><span class="section-number">7.1.3.3. </span>产品设置文件<a class="headerlink" href="#id12" title="永久链接至标题"></a></h3>
<p>以文件 data/board_config/xj3/xj3_sdb.json 为例说明：</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;xj3_sdb&quot;</span><span class="p">,</span>
        <span class="nt">&quot;ota_mode&quot;</span><span class="p">:[],</span>
        <span class="nt">&quot;support_mode&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;uboot&quot;</span><span class="p">,</span> <span class="s2">&quot;uart&quot;</span><span class="p">],</span>
        <span class="nt">&quot;boot_choose&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;lpddr4-samsung-3200-110&quot;</span><span class="p">,</span> <span class="s2">&quot;choose&quot;</span><span class="p">],</span>
        <span class="nt">&quot;uart_mode&quot;</span><span class="p">:[</span><span class="s2">&quot;tftp&quot;</span><span class="p">,</span> <span class="s2">&quot;uart&quot;</span><span class="p">,</span> <span class="s2">&quot;fastboot&quot;</span><span class="p">],</span>
        <span class="nt">&quot;erase_part&quot;</span><span class="p">:[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;veeprom&quot;</span><span class="p">,</span> <span class="s2">&quot;sbl&quot;</span><span class="p">,</span> <span class="s2">&quot;ddr&quot;</span><span class="p">,</span> <span class="s2">&quot;bl31&quot;</span><span class="p">,</span> <span class="s2">&quot;uboot&quot;</span><span class="p">,</span> <span class="s2">&quot;vbmeta&quot;</span><span class="p">,</span> <span class="s2">&quot;boot&quot;</span><span class="p">,</span> <span class="s2">&quot;recovery&quot;</span><span class="p">,</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;bpu&quot;</span><span class="p">,</span> <span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;userdata&quot;</span><span class="p">],</span>
        <span class="nt">&quot;baudrate&quot;</span><span class="p">:</span><span class="mi">921600</span><span class="p">,</span>
        <span class="nt">&quot;support_os&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Linux&quot;</span><span class="p">,</span> <span class="s2">&quot;Windows&quot;</span><span class="p">],</span>
        <span class="nt">&quot;partition_backup&quot;</span><span class="p">:[</span><span class="s2">&quot;veeprom&quot;</span><span class="p">,</span> <span class="s2">&quot;ddr&quot;</span><span class="p">,</span> <span class="s2">&quot;sbl&quot;</span><span class="p">,</span> <span class="s2">&quot;bl31&quot;</span><span class="p">],</span>
        <span class="nt">&quot;ddr_size&quot;</span><span class="p">:</span> <span class="s2">&quot;0x100000000&quot;</span><span class="p">,</span>
        <span class="nt">&quot;load_address&quot;</span><span class="p">:</span> <span class="s2">&quot;0x06000000&quot;</span><span class="p">,</span>
        <span class="nt">&quot;download_root&quot;</span><span class="p">:</span> <span class="s2">&quot;/userdata&quot;</span><span class="p">,</span>
        <span class="nt">&quot;download_speed&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="nt">&quot;download_speed_uart&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="nt">&quot;boot_config&quot;</span><span class="p">:{</span>
            <span class="nt">&quot;lpddr4-samsung-3200-110&quot;</span><span class="p">:</span><span class="s2">&quot;data/board_config/xj3-key1/boot_config/xj3_sdb_lpddr4_samsung_secure_boot.json&quot;</span><span class="p">,</span>
            <span class="nt">&quot;lpddr4-hynix-2666-608&quot;</span><span class="p">:</span><span class="s2">&quot;data/board_config/xj3-key1/boot_config/xj3_sdb_lpddr4_hynix_secure_boot.json&quot;</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>name： 产品名称</p></li>
<li><p>ota_mode：ota下载模式支持的下载方式</p></li>
<li><p>support_mode：支持的下载模式</p></li>
<li><p>boot_choose：uart下载模式下支持的ddr类型</p></li>
<li><p>uart_mode：uart和uboot下载模式下支持的下载方式</p></li>
<li><p>erase_part：可以擦除的分区列表</p></li>
<li><p><strong>baudrate</strong>：串口波特率</p></li>
<li><p>support_os：PC机可用操作系统</p></li>
<li><p>ddr_size：X3 硬件板上的ddr容量</p></li>
<li><p>load_address：uart、uboot下载模式下通过tftp下载方式方式时，在uboot阶段，向DDR内下载镜像的起始地址</p></li>
<li><p>download_root： OTA下载模式下，系统内ota镜像的存放位置</p></li>
<li><p>boot_config：uart下载模式下支持的boot所需文件的配置文件</p></li>
</ul>
</section>
<section id="boot">
<h3><span class="section-number">7.1.3.4. </span>自定义boot文件<a class="headerlink" href="#boot" title="永久链接至标题"></a></h3>
<p>data/board_config/xj3/boot_config/xj3_dvb_hynix_boot.json文件如下：</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;file&quot;</span><span class="p">:</span> <span class="s2">&quot;data/board_config/xj3-key1/boot_config/boot_file/spl-uart-secure.bin&quot;</span><span class="p">,</span>
    <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;xmodem&quot;</span><span class="p">,</span>
    <span class="nt">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">3</span>
<span class="p">},</span>
<span class="p">{</span>
    <span class="nt">&quot;file&quot;</span><span class="p">:</span> <span class="s2">&quot;data/xj3-ddr/HYNIX-LPDDR4-3200-610-ddr.bin&quot;</span><span class="p">,</span>
    <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;ymodem&quot;</span><span class="p">,</span>
    <span class="nt">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">},</span>
<span class="p">{</span>
    <span class="nt">&quot;file&quot;</span><span class="p">:</span> <span class="s2">&quot;data/board_config/xj3-key1/boot_config/boot_file/boot_uart_secure.pkg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;ymodem&quot;</span><span class="p">,</span>
    <span class="nt">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>
</pre></div>
</div>
<p>XJ3系统uart启动需要的文件为spl*.bin,
ddr文件及boot_uart.pkg，三个文件，传输模式分别为xmodem，ymodem，ymodem，客户可以自行定义json文件，并在启动界面-&gt;升级配置-&gt;内存类型中选择”choose模式，然后进行json文件的选择，方便客户启动自己定制的系统，选择界面如下图所示。</p>
<p><img alt="../_images/image-20220327135336948.png" src="../_images/image-20220327135336948.png" /></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="7. PC工具使用指南" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../FAQs/index.html" class="btn btn-neutral float-right" title="8. FAQ" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, Horizon Robotics.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>